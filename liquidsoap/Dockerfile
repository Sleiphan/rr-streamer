# In short, this Dockerfile just adds a file server capability to the ready made Liquidsoap image.
# This makes it easy to edit the selection of audio files which Liquidsoap can choose from.

# Enforce line endings in 
FROM debian:latest AS format
COPY rr-liquidsoap.liq docker-entrypoint.sh ./
RUN apt update && apt install -y dos2unix
RUN dos2unix ./*

# Set a specific version of the Liquidsoap image as the base image. The version "9ab21ac" was released 16-oct-2024.
FROM savonet/liquidsoap:v2.3.1 AS base

# Set the work directory to the home folder of the user 'liquidsoap'. The user 'liquidsoap' is generated by the base image.
WORKDIR /var/cache/liquidsoap

# Copy relevant files to their proper destinations
COPY --from=format ./rr-liquidsoap.liq ./docker-entrypoint.sh ./

# Change to user 'root' for the next steps.
USER root

# Make sure that the startup script is executable.
RUN chmod +x docker-entrypoint.sh

# Switch back to the user 'liquidsoap', as the base image originally intended.
USER liquidsoap

# Make all containers generated from this image run the startup script.
ENTRYPOINT [ "./docker-entrypoint.sh" ]